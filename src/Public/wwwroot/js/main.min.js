function periodToSeconds(e){const t=e.match(/PT?(?:(\d+)M)?(?:(\d+)S)/);return 60*(t[1]?parseInt(t[1]):0)+(t[2]?parseInt(t[2]):0)}function secondsToPeriod(e){return`PT${Math.floor(e/60)}M${e%60}S`}function setCookie(e,t,n){const a=encodeURIComponent(e),s=encodeURIComponent(t),i=new Date(n).toUTCString();document.cookie=`${a}=${s};expires=${i};path=/`}function Countdown(e){const t=this;this.startTime=new Date,this.duration=periodToSeconds(e.attr("datetime")),this.timerId=setInterval(()=>t.updateCountdown(),500),this.updateCountdown=function(){const n=(new Date-t.startTime)/1e3;var a=t.duration-n;a<=0&&(clearInterval(t.timerId),a=0),e.attr("datetime",secondsToPeriod(a)),e.text(function(e){const t=Math.floor(e/60),n=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}(a))}}function SeatSelector(e,t){const n=this;this._$reservationPageUrl=e.data("reservation-page-url");const a=new function(e){const n=this;this._$formElement=e,this._$selectElement=e.find("select"),this._$errorElement=$("<div>").addClass("form-text text-danger").insertAfter(this._$selectElement),this.onChange=null,this.onConflict=null,this.onSuccess=null,this._$selectElement.change(()=>{const e=n._$selectElement.val();n.onChange&&n.onChange(e)}),this._$formElement.on("submit",function(e){this.checkValidity()&&(e.preventDefault(),n.submit())}),this.addSeats=function(e){$.each(e,function(e,t){if("available"===t.status){const e=$("<option>").val(t.index+1).text(t.$element.text());n._$selectElement.append(e)}})},this.removeSeat=function(e){const t=n._$selectElement.find(`[value=${e}]`);t&&t.remove()},this.selectSeat=function(e){n._$selectElement.val(e)},this.submit=function(){const t=new FormData(n._$formElement[0]).entries(),a=Object.fromEntries(t);$.ajax({url:e.attr("action"),method:e.attr("method").toUpperCase(),contentType:"application/json",data:JSON.stringify(a)}).done(function(e){n._handleSuccess(a,e)}).fail(function(e){403===e.status?n._handleUnauthorized(e.responseJSON):409===e.status&&n._handleConflict(a)})},this.updateSeat=function(e){if("available"!==e.status)n.removeSeat(e.index+1);else{var t;n._$selectElement.children().each(function(){return(t=$(this)).text()<=e.$element.text()});const a=$("<option>").val(e.index+1).text(e.$element.text());e.$element.text()===t.text()?t.replaceWith(a):a.insertBefore(t)}},this._handleUnauthorized=function(e){const a=t[403][e.failureReason];n._$errorElement.text(a)},this._handleConflict=function(e){const a=t[403];n._$errorElement.text(a.replace("{}",e.seatNumber)),n.onConflict&&n.onConflict(e)},this._handleSuccess=function(e,t){n.onSuccess&&n.onSuccess(e,t)}}(e.find("form")),s=new function(e){const t=this;this._initialFontSize=parseFloat(e.css("font-size")),this._idealParentWidth=e.data("scaled-for-parent-width"),this._seats=[],this._selection=null,this.onInitialized=null,this.onSelected=null,this.onDeselected=null,this.build=function(){e.find(".seat").each((e,n)=>{var a=$(n);t._addSeatToMemory(a),t._addSeatClickHandler(a)}),$(window).resize(()=>t._scaleToFit()),t._scaleToFit(),t.onInitialized&&t.onInitialized(t._seats),e.addClass("initialized")},this.deselectSeat=function(e){var n=t._seats[e];n&&"selected"===n.status&&(n.status="available",n.$element.removeClass("selected"),n.$element.addClass("available"),t._selection=null,t.onDeselected&&t.onDeselected(n))},this.selectSeat=function(e){var n=t._seats[e];n?"available"===n.status&&(n.status="selected",n.$element.removeClass("available"),n.$element.addClass("selected"),t._selection&&t.deselectSeat(t._selection.index),t._selection=n,t.onSelected&&t.onSelected(n)):t._selection&&t.deselectSeat(t._selection.index)},this.updateSeat=function(e,n){const a=t._seats[e];if(!a)return!1;return("selected"===a.status?"available":a.status)!==n&&(a.status=n,a.$element.attr("class","seat "+n),a)},this._addSeatToMemory=function(e){var n=e.data("index"),a=e.data("status");t._seats[n]={index:n,status:a,$element:e}},this._addSeatClickHandler=function(e){e.click(function(){var e=$(this).data("index"),n=t._seats[e];"selected"===n.status?t.deselectSeat(e):"available"===n.status&&t.selectSeat(e)})},this._scaleToFit=function(){var n=e.parent().width();if(n<t._idealParentWidth){var a=n/t._idealParentWidth,s=t._initialFontSize*a;e.css("font-size",s+"px")}}}(e.find(".interactive-seat-selector"));a.onChange=e=>s.selectSeat(e-1),s.onInitialized=e=>a.addSeats(e),s.onSelected=e=>a.selectSeat(e.index+1),s.onDeselected=()=>a.selectSeat(null),s.build(),a.onConflict=function(e){a.removeSeat(e.seatNumber),s.deselectSeat(e.seatNumber-1),s.updateSeat(e.seatNumber-1,"on-hold")},a.onSuccess=function(e,t){setCookie("seatLock",JSON.stringify(t),t.lockExpiration),document.location=n._$reservationPageUrl};var i=new function(){const e=this;this.onSeatRefreshed=null,this._connection=(new signalR.HubConnectionBuilder).withUrl("/api/watch-seats").build(),this._connection.on("SEATS_UPDATED",e=>this._onSeatsRefreshed(e)),window.addEventListener("pageshow",()=>e.reloadStatuses()),this.reloadStatuses=async function(){null!==e.onSeatRefreshed&&$.getJSON("/api/seat-statuses",e=>this._onSeatsRefreshed(e))},this.start=async function(){try{await e._connection.start(),console.log("Connected to `watch-seats` endpoint.")}catch(e){console.error(e)}},this._onSeatsRefreshed=function(t){null!==e.onSeatRefreshed&&Object.entries(t).forEach(([t,n])=>{e.onSeatRefreshed(t,n)})}};i.onSeatRefreshed=function(e,t){const n=s.updateSeat(e-1,t);n&&a.updateSeat(n)},i.start()}window.addEventListener("load",function(){$("time.countdown").each(function(){new Countdown($(this))})}),window.addEventListener("load",function(){const e=$(".lazy-loaded").map(function(e,t){return{$element:$(t),callback:$(t).data("onload"),priority:parseInt($(t).data("priority"))||5}}).get();e.sort((e,t)=>e.priority-t.priority),e.forEach(function(e){window[e.callback](e.$element)})});