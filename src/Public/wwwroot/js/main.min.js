function periodToSeconds(t){const e=t.match(/PT?(?:(\d+)M)?(?:(\d+)S)/);return 60*(e[1]?parseInt(e[1]):0)+(e[2]?parseInt(e[2]):0)}function secondsToPeriod(t){return`PT${Math.floor(t/60)}M${t%60}S`}function setCookie(t,e,a){const n=encodeURIComponent(t),s=encodeURIComponent(e),o=new Date(a).toUTCString();document.cookie=`${n}=${s};expires=${o};path=/`}function Countdown(t){const e=this;this.startTime=new Date,this.duration=periodToSeconds(t.attr("datetime")),this.timerId=setInterval(()=>e.updateCountdown(),500),this.updateCountdown=function(){const a=(new Date-e.startTime)/1e3;var n=e.duration-a;n<=0&&(clearInterval(e.timerId),n=0),t.attr("datetime",secondsToPeriod(n)),t.text(function(t){const e=Math.floor(t/60),a=Math.floor(t%60);return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}(n))}}function SeatSelector(t,e){var a=!1;const n=[];var s=[];const o=t.find(".interactive-seat-selector"),i=t.find("form"),r=i.find(".form-select"),d=$("<div>").addClass("form-text text-danger d-hidden").insertBefore(i.find(".btn-primary")),c=t.data("max-seat-selections"),l=o.data("scaled-for-parent-width"),u=parseFloat(o.css("font-size"));$(window).on("pageshow",function(){$.getJSON("/api/seat-statuses",h)}).resize(b),b(),r.change(function(){const t=$(this),e=t.data("value"),a=t.val();a?(e&&f(n[e-1]),m(n[a-1]),r.each((t,e)=>{r.each((a,n)=>{if(t!==a){const t=$(n);$(e).val()===t.val()&&t.val("").data("value","")}})})):e&&(f(n[e-1]),p());t.data("value",a)}),i.on("submit",function(t){if(!this.checkValidity())return;if(t.preventDefault(),a)return;a=!0,$.ajax({url:"/api/lock-seats",method:"POST",data:i.serialize()}).done(t=>{const e=JSON.stringify(t);setCookie("seatLocks",e,e.lockExpiration),document.location="/reservation/new"}).fail(t=>{if(403===t.status)d.text(e[403][t.responseJSON.failureReason]),d.removeClass("d-hidden");else if(409===t.status){const a=t.responseJSON.seatNumber;d.text(e[409].replace("{}",a)),d.removeClass("d-hidden")}}).always(()=>a=!1)}),o.find(".seat").each((t,e)=>{const a=$(e),s=a.data("number");n[s-1]={$element:a,number:s,status:a.data("status")},a.click(v)}),$.each(n,(t,e)=>{const a="available"===e.status;r.each((t,n)=>{const s=$("<option>").data("status",e.status).prop("disabled",!a).prop("hidden",!a).text(e.number).val(e.number);$(n).append(s)})});try{const t=(new signalR.HubConnectionBuilder).withUrl("/api/watch-seats").build();t.on("SEATS_UPDATED",h),t.start(),console.log("Started live updates feature.")}catch(t){console.error("Unable to start live updates feature.")}function f(t){t.status="available",t.$element.removeClass("selected").addClass("available"),s=s.filter(e=>e.number!==t.number),r.each((e,a)=>{const n=$(a);if(n.val()===t.number.toString())return n.val("").data("value",""),!1})}function p(){r.each((t,e)=>{const a=s[t]?s[t].number:"";$(e).val(a).data("value",a)})}function h(t){Object.entries(t).forEach(([t,e])=>{const a=n[t-1];if(a.status===e||"selected"===a.status&&"available"===e)return;"selected"===a.status&&(f(a),p()),a.status=e,a.$element.attr("class","seat "+e);const s="available"===a.status;r.each((a,n)=>{$(n).find(`[value=${t}]`).data("status",e).prop("disabled",!s).prop("hidden",!s)})})}function m(t){t.status="selected",t.$element.removeClass("available").addClass("selected"),s.push(t),s.length>c&&f(s.shift()),r.each((e,a)=>{const n=$(a);if(""===n.val())return n.val(t.number).data("value",t.number),!1})}function v(){const t=n[$(this).data("number")-1];"selected"===t.status?(f(t),p()):"available"===t.status&&m(t)}function b(){const t=o.parent().width();if(t<l){const e=u*(t/l);o.css("font-size",e+"px")}}}window.addEventListener("load",function(){$("time.countdown").each(function(){new Countdown($(this))})}),window.addEventListener("load",function(){const t=$(".lazy-loaded").map(function(t,e){return{$element:$(e),callback:$(e).data("onload"),priority:parseInt($(e).data("priority"))||5}}).get();t.sort((t,e)=>t.priority-e.priority),t.forEach(function(t){window[t.callback](t.$element)})});