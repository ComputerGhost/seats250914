@using Core.Domain.Authorization
@inject IViewLocalizer Localizer;
@model ReserveSeatsViewModel;

@{
    ViewData["Title"] = Localizer["Seat Reservation"].Value;
}

@section Scripts
{
    <script>
        window.addEventListener("load", function () {
            const periodUntilExpiration = "@Model.TimeUntilExpirationPeriod";
            const secondsUntilExpiration = periodToSeconds(periodUntilExpiration);
            setTimeout(function () {
                window.location = "@Url.Action("TimeExpired")";
            }, secondsUntilExpiration * 1000);
        });
    </script>
}

<div class="container py-3">
    <h1>@Localizer["Seat Reservation"]</h1>

    @if (Model.FailureReason == AuthorizationRejectionReason.KeyIsInvalid
        || Model.FailureReason == AuthorizationRejectionReason.SeatIsNotLocked
        || Model.FailureReason == AuthorizationRejectionReason.KeyIsExpired)
    {
        <div>@Localizer["<!-- AuthorizationResult.KeyIsInvalid -->"]</div>
    }
    else if (Model.FailureReason == AuthorizationRejectionReason.ReservationsAreClosed)
    {
        <div>@Localizer["<!-- AuthorizationResult.ReservationsAreClosed -->"]</div>
    }
    else if (Model.FailureReason == AuthorizationRejectionReason.TooManyReservationsForEmail)
    {
        <div>@Localizer["<!-- AuthorizationResult.TooManyReservationsForEmail -->"]</div>
    }
    else
    {
        <section>
            @Localizer["<!-- seat information -->",
                Model.SeatNumbersJoined,
                Model.TimeUntilExpirationText,
                Model.TimeUntilExpirationPeriod,
                Model.OrganizerEmail
            ]
        </section>
    }
    
    <form method="post">
        <section>
            <div class="mb-3">
                <label asp-for="SeatNumbersJoined" class="form-label">Seat</label>
                <input asp-for="SeatNumbersJoined" class="form-control" disabled>
            </div>
        </section>

        <section>
            <div class="mb-3">
                <label asp-for="Name" class="form-label">@Localizer["Name"]</label>
                <input asp-for="Name" class="form-control" maxlength="50" required>
            </div>
            <div class="mb-3">
                <label asp-for="Email" class="form-label">@Localizer["Email"]</label>
                <input asp-for="Email" class="form-control" maxlength="254" required>
            </div>
            <div class="mb-3">
                <label asp-for="PhoneNumber" class="form-label">@Localizer["Phone number"]</label>
                <input asp-for="PhoneNumber" class="form-control" maxlength="15" aria-describedby="phoneHelp">
                <div id="phoneHelp" class="form-text">
                    @Localizer["Please provide a Korean phone number if possible."]
                </div>
            </div>
            <div class="mb-3">
                <label asp-for="PreferredLanguageAbbreviated" class="form-label">@Localizer["Preferred language"]</label>
                <select asp-for="PreferredLanguageAbbreviated" class="form-select" required>
                    <option value="en">English</option>
                    <option value="ko">한국어</option>
                    <option value="vi">Tiếng Việt</option>
                    <option value="zh-Hans">中文（简体）</option>
                </select>
            </div>
        </section>

        <section>
            @Localizer["<!-- form disclosures -->"]

            <div class="form-check mb-3">
                <input asp-for="AgreeToTerms" class="form-check-input" required>
                <label asp-for="AgreeToTerms" class="form-check-label">
                    @Localizer["I accept the terms of service and privacy policy linked above."]
                </label>
            </div>
        </section>

        <section class="mb-3">
            <button name="action" value="cancel" type="submit" class="btn btn-secondary" formnovalidate>@Localizer["Cancel"]</button>
            <button name="action" value="submit" type="submit" class="btn btn-primary">@Localizer["Submit"]</button>
        </section>
    </form>
</div>
