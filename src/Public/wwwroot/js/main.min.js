function periodToSeconds(t){const e=t.match(/PT?(?:(\d+)M)?(?:(\d+)S)/);return 60*(e[1]?parseInt(e[1]):0)+(e[2]?parseInt(e[2]):0)}function secondsToPeriod(t){return`PT${Math.floor(t/60)}M${t%60}S`}function setCookie(t,e,n){const i=encodeURIComponent(t),s=encodeURIComponent(e),a=new Date(n).toUTCString();document.cookie=`${i}=${s};expires=${a};path=/`}function Countdown(t){const e=this;this.startTime=new Date,this.duration=periodToSeconds(t.attr("datetime")),this.timerId=setInterval(()=>e.updateCountdown(),500),this.updateCountdown=function(){const n=(new Date-e.startTime)/1e3;var i=e.duration-n;i<=0&&(clearInterval(e.timerId),i=0),t.attr("datetime",secondsToPeriod(i)),t.text(function(t){const e=Math.floor(t/60),n=Math.floor(t%60);return`${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}(i))}}function SeatSelector(t,e){const n=this;this._$reservationPageUrl=t.data("reservation-page-url");const i=new function(t){const n=this;this._isSubmitting=!1,this._isActive=1===t.length,this._$formElement=t,this._$selectElement=t.find("select"),this._$errorElement=$("<div>").addClass("form-text text-danger").insertAfter(this._$selectElement),this.onChange=null,this.onConflict=null,this.onSuccess=null,this._$selectElement.change(()=>{const t=n._$selectElement.val();n.onChange&&n.onChange(t)}),this._$formElement.on("submit",function(t){this.checkValidity()&&(t.preventDefault(),n._submit())}),this.addSeats=function(t){n._isActive&&$.each(t,function(t,e){n.updateSeat(e)})},this.removeSeat=function(t){if(!n._isActive)return;const e=n._$selectElement.find(`[value=${t}]`);e&&e.remove()},this.selectSeat=function(t){n._isActive&&n._$selectElement.val(t)},this.updateSeat=function(t){if(!n._isActive)return;if("available"!==t.status)return void n.removeSeat(t.index+1);var e=null;n._$selectElement.children().each(function(){const n=$(this);if(""!==n.text()){if(parseInt(n.text())>parseInt(t.$element.text()))return!1}e=n});const i=$("<option>").val(t.index+1).text(t.$element.text());e.text()===i.text()?e.replaceWith(i):i.insertAfter(e)},this._handleUnauthorized=function(t){const i=e[403][t.failureReason];n._$errorElement.text(i)},this._handleConflict=function(t){const i=e[403];n._$errorElement.text(i.replace("{}",t.seatNumber)),n.onConflict&&n.onConflict(t)},this._handleSuccess=function(t,e){n.onSuccess&&n.onSuccess(t,e)},this._submit=function(){const e=new FormData(n._$formElement[0]).entries(),i=Object.fromEntries(e);n._isSubmitting||(n._isSubmitting=!0,$.ajax({url:t.attr("action"),method:t.attr("method").toUpperCase(),contentType:"application/json",data:JSON.stringify(i)}).done(function(t){n._handleSuccess(i,t)}).fail(function(t){403===t.status?n._handleUnauthorized(t.responseJSON):409===t.status&&n._handleConflict(i)}).always(function(){n._isSubmitting=!1}))}}(t.find("form")),s=new function(t){const e=this;this._initialFontSize=parseFloat(t.css("font-size")),this._idealParentWidth=t.data("scaled-for-parent-width"),this._seats=[],this._selection=null,this.onInitialized=null,this.onSelected=null,this.onDeselected=null,this.build=function(){t.find(".seat").each((t,n)=>{var i=$(n);e._addSeatToMemory(i),e._addSeatClickHandler(i)}),$(window).resize(()=>e._scaleToFit()),e._scaleToFit(),e.onInitialized&&e.onInitialized(e._seats),t.addClass("initialized")},this.deselectSeat=function(t){var n=e._seats[t];n&&"selected"===n.status&&(n.status="available",n.$element.removeClass("selected"),n.$element.addClass("available"),e._selection=null,e.onDeselected&&e.onDeselected(n))},this.selectSeat=function(t){var n=e._seats[t];n?"available"===n.status&&(n.status="selected",n.$element.removeClass("available"),n.$element.addClass("selected"),e._selection&&e.deselectSeat(e._selection.index),e._selection=n,e.onSelected&&e.onSelected(n)):e._selection&&e.deselectSeat(e._selection.index)},this.updateSeat=function(t,n){const i=e._seats[t];if(!i)return!1;if("selected"===i.status){if("available"===n)return!1;e.deselectSeat(t)}return i.status=n,i.$element.attr("class","seat "+n),i},this._addSeatToMemory=function(t){var n=t.data("index"),i=t.data("status");e._seats[n]={index:n,status:i,$element:t}},this._addSeatClickHandler=function(t){t.click(function(){var t=$(this).data("index"),n=e._seats[t];"selected"===n.status?e.deselectSeat(t):"available"===n.status&&e.selectSeat(t)})},this._scaleToFit=function(){var n=t.parent().width();if(n<e._idealParentWidth){var i=n/e._idealParentWidth,s=e._initialFontSize*i;t.css("font-size",s+"px")}}}(t.find(".interactive-seat-selector"));i.onChange=t=>s.selectSeat(t-1),s.onInitialized=t=>i.addSeats(t),s.onSelected=t=>i.selectSeat(t.index+1),s.onDeselected=()=>i.selectSeat(null),s.build(),i.onConflict=function(t){i.removeSeat(t.seatNumber),s.deselectSeat(t.seatNumber-1),s.updateSeat(t.seatNumber-1,"on-hold")},i.onSuccess=function(t,e){setCookie("seatLock",JSON.stringify(e),e.lockExpiration),document.location=n._$reservationPageUrl};var a=new function(){const t=this;this.onSeatRefreshed=null,this._connection=(new signalR.HubConnectionBuilder).withUrl("/api/watch-seats").build(),this._connection.on("SEATS_UPDATED",t=>this._onSeatsRefreshed(t)),window.addEventListener("pageshow",()=>t.reloadStatuses()),this.reloadStatuses=async function(){null!==t.onSeatRefreshed&&$.getJSON("/api/seat-statuses",t=>this._onSeatsRefreshed(t))},this.start=async function(){try{await t._connection.start(),console.log("Connected to `watch-seats` endpoint.")}catch(t){console.error(t)}},this._onSeatsRefreshed=function(e){null!==t.onSeatRefreshed&&Object.entries(e).forEach(([e,n])=>{t.onSeatRefreshed(e,n)})}};a.onSeatRefreshed=function(t,e){const n=s.updateSeat(t-1,e);n&&i.updateSeat(n)},a.start()}window.addEventListener("load",function(){$("time.countdown").each(function(){new Countdown($(this))})}),window.addEventListener("load",function(){const t=$(".lazy-loaded").map(function(t,e){return{$element:$(e),callback:$(e).data("onload"),priority:parseInt($(e).data("priority"))||5}}).get();t.sort((t,e)=>t.priority-e.priority),t.forEach(function(t){window[t.callback](t.$element)})});